

# MASH
mkdir /ALMEIDA/PROJECTS/BACTERIAS/DGSP/resources/mash
cd /ALMEIDA/PROJECTS/BACTERIAS/DGSP/resources/mash
#wget https://obj.umiacs.umd.edu/mash/screen/RefSeq88n.msh.gz
wget https://gembox.cbcb.umd.edu/mash/refseq.genomes.k21s1000.msh


# BACTIPE
cd /ALMEIDA/PROJECTS/BACTERIAS/DGSP/resources
wget https://github.com/ctmrbio/BACTpipe/archive/refs/tags/v2.7.0.zip
unzip v2.7.0.zip
rm v2.7.0.zip



mamba env create -f dgsp_efsa_sp.yml


cd /software/miniconda3/envs/dgsp_efsa_sp/bin
#wget https://github.com/nextflow-io/nextflow/releases/download/v0.26.0/nextflow
wget https://github.com/nextflow-io/nextflow/releases/download/v20.10.0/nextflow-20.10.0-all
20.10.0
chmod 755 nextflow-20.10.0-all

conda activate dgsp_efsa_sp
cpanm XML::Simple

prokka --setupdb

Si hay problemas con las versiones y con otro Perl
% which -a perl
% perl -V | tail
% prokka --version


nextflow


mamba env update -f dgsp_efsa_contamination.yml
CONDAPATH="/software/miniconda3/envs"

# Necesitamos python 2.7 para INNUca
mamba env update -f dgsp_efsa_py27.yml

cd ${CONDAPATH}/dgsp_efsa_contamination
git clone https://github.com/B-UMMI/INNUca.git

git clone https://github.com/B-UMMI/ReMatCh.git
cd ReMatCh
python3 setup.py install

export PATH="${CONDAPATH}/dgsp_efsa_contamination/INNUca:${CONDAPATH}/dgsp_efsa_contamination/ReMatCh/ReMatCh:$PATH"

dgsp_efsa_contamination/ReMatCh/ReMatCh
# Remplazar #!/usr/bin/env python2 por

#!/software/miniconda3/envs/dgsp_efsa_py27/bin/python2.7


https://olc-bioinformatics.github.io/ConFindr/install/
ConFindr

https://pubmlst.org/data

###############################################################3
#Listeria monocytogenes

# AÃ±adimos al fichero map

echo -e "listeria_monocytogenes\tListeria\tmonocytogenes" >> /software/miniconda3/envs/dgsp_efsa_contamination/db/scheme_species_map.tab

# Creamos carpeta y metemos ficheros
DBlm=/software/miniconda3/envs/dgsp_efsa_contamination/db/pubmlst/listeria_monocytogenes
mkdir -p ${DBlm}
curl -o ${DBlm}/listeria_monocytogenes.txt https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/schemes/2/profiles_csv
curl -o ${DBlm}/abcZ.tfa https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/loci/abcZ/alleles_fasta
curl -o ${DBlm}/bglA.tfa https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/loci/bglA/alleles_fasta
curl -o ${DBlm}/cat.tfa https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/loci/cat/alleles_fasta
curl -o ${DBlm}/dapE.tfa https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/loci/dapE/alleles_fasta
curl -o ${DBlm}/dat.tfa https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/loci/dat/alleles_fasta
curl -o ${DBlm}/ldh.tfa https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/loci/ldh/alleles_fasta
curl -o ${DBlm}/lhkA.tfa https://bigsdb.pasteur.fr/api/db/pubmlst_listeria_seqdef/loci/lhkA/alleles_fasta




# si quisieramos tirar por misma base de datos 
# /software/miniconda3/envs/dgsp_efsa_contamination/bin/mlst-download_pub_mlst -d db_mlst




















################### INTENTO CREAR BASE DE DATOS ACTUALIZADA MASH
# Get the list of assemblies:
wget ftp.ncbi.nlm.nih.gov/genomes/refseq/assembly_summary_refseq.txt 
Parse the addresses of complete genomes from it (right now n = 44632):
#awk -F '\t' '{if($12=="Complete Genome") print $0}' assembly_summary_refseq.txt > assembly_summary_refseq_complete_genomes.txt
#awk -F '\t' '{print $20}' assembly_summary_refseq_complete_genomes.txt > assembly_summary_refseq_complete_genomes_link.txt

# 13637 sequences
awk -F '\t' '{if($12=="Complete Genome") print $0}' assembly_summary_refseq.txt | grep "Salmonella\|Listeria\|Campylobacter\|Escherichia\|Enterococcus\|Enterobacter\|Yersinia\|Klebsiella\|Neisseria\|Treponema\|Staphylococcus\|Streptococcus\|coronavirus\|Influenza\|neumovirus\|hinovirus\|denovirus\|arainfluenza\|aemophilus\|ycobacterium\|eishmania\|lavivirus\|lasmodium\|Ebola" > assembly_summary_refseq_complete_selected.txt
awk -F '\t' '{print $20}' assembly_summary_refseq_complete_selected.txt > assembly_summary_refseq_complete_selected_link.txt


# Make a dir for data
mkdir refseq

# Fetch data
for next in $(cat assembly_summary_refseq_complete_selected_link.txt); do wget -P refseq "$next"/${next##*/}_genomic.fna.gz; done >> download-refseq.log 2>&1


for next in $(cat assembly_summary_refseq_complete_selected_link.txt); do cp refseq_full/${next##*/}* refseq; done

# Extract data

rm refseq/GCF_000006645.1_ASM664v1_genomic.fna.gz
gunzip refseq/*.gz

#Concatenate data

cat refseq/*.fna > all_complete_refseq.fasta


wget https://obj.umiacs.umd.edu/mash/screen/RefSeq88n.msh.gz

wget https://gembox.cbcb.umd.edu/mash/refseq.genomes.k21s1000.msh

# otro https://gitlab.bfr.berlin/bfr_bioinformatics/bakcharak_resources/-/raw/main/databases/mash.tar.gz
